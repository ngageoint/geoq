(function(b){function a(c){if(c.tagName.toLowerCase()!=="form"){return a(c.parentNode)}return c}window.SelectFilter={init:function(g,c,p){if(g.match(/__prefix__/)){return}var d=document.getElementById(g);d.id+="_from";d.className="filtered";var v=d.parentNode.getElementsByTagName("p");for(var x=0;x<v.length;x++){if(v[x].className.indexOf("info")!==-1){d.parentNode.removeChild(v[x])}else{if(v[x].className.indexOf("help")!==-1){d.parentNode.insertBefore(v[x],d.parentNode.firstChild)}}}var n=quickElement("div",d.parentNode);n.className=p?"selector stacked":"selector";var u=quickElement("div",n);u.className="selector-available";var l=quickElement("h4",u,interpolate(gettext("Available %s")+" ",[c]));quickElement("span",l,"","class","help help-tooltip help-icon","title",interpolate(gettext('This is the list of available %s. You may choose some by selecting them in the box below and then clicking the "Choose" arrow between the two boxes.'),[c]));var e=quickElement("p",u,"","id",g+"_filter");e.className="selector-filter";var h=quickElement("label",e,"","for",g+"_input");quickElement("span",h,"","class","help-tooltip search-label-icon","title",interpolate(gettext("Type into this box to filter down the list of available %s."),[c]));e.appendChild(document.createTextNode(" "));var k=quickElement("input",e,"","type","text","placeholder",gettext("Filter"));k.id=g+"_input";u.appendChild(d);var m=quickElement("a",u,gettext("Choose all"),"title",interpolate(gettext("Click to choose all %s at once."),[c]),"href","#","id",g+"_add_all_link");m.className="selector-chooseall";var o=quickElement("ul",n);o.className="selector-chooser";var t=quickElement("a",quickElement("li",o),gettext("Choose"),"title",gettext("Choose"),"href","#","id",g+"_add_link");t.className="selector-add";var w=quickElement("a",quickElement("li",o),gettext("Remove"),"title",gettext("Remove"),"href","#","id",g+"_remove_link");w.className="selector-remove";var r=quickElement("div",n);r.className="selector-chosen";var f=quickElement("h4",r,interpolate(gettext("Chosen %s")+" ",[c]));quickElement("span",f,"","class","help help-tooltip help-icon","title",interpolate(gettext('This is the list of chosen %s. You may remove some by selecting them in the box below and then clicking the "Remove" arrow between the two boxes.'),[c]));var j=quickElement("select",r,"","id",g+"_to","multiple","multiple","size",d.size,"name",d.getAttribute("name"));j.className="filtered";var z=quickElement("a",r,gettext("Remove all"),"title",interpolate(gettext("Click to remove all chosen %s at once."),[c]),"href","#","id",g+"_remove_all_link");z.className="selector-clearall";d.setAttribute("name",d.getAttribute("name")+"_old");addEvent(m,"click",function(){SelectBox.move_all(g+"_from",g+"_to");SelectFilter.refresh_icons(g)});addEvent(t,"click",function(){SelectBox.move(g+"_from",g+"_to");SelectFilter.refresh_icons(g)});addEvent(w,"click",function(){SelectBox.move(g+"_to",g+"_from");SelectFilter.refresh_icons(g)});addEvent(z,"click",function(){SelectBox.move_all(g+"_to",g+"_from");SelectFilter.refresh_icons(g)});addEvent(k,"keypress",function(i){SelectFilter.filter_key_press(i,g)});addEvent(k,"keyup",function(i){SelectFilter.filter_key_up(i,g)});addEvent(k,"keydown",function(i){SelectFilter.filter_key_down(i,g)});addEvent(d,"change",function(i){SelectFilter.refresh_icons(g)});addEvent(j,"change",function(i){SelectFilter.refresh_icons(g)});addEvent(d,"dblclick",function(){SelectBox.move(g+"_from",g+"_to");SelectFilter.refresh_icons(g)});addEvent(j,"dblclick",function(){SelectBox.move(g+"_to",g+"_from");SelectFilter.refresh_icons(g)});addEvent(a(d),"submit",function(){SelectBox.select_all(g+"_to")});SelectBox.init(g+"_from");SelectBox.init(g+"_to");SelectBox.move(g+"_from",g+"_to");if(!p){var q=b(d);var s=b(j);var y=function(){s.height(b(e).outerHeight()+q.outerHeight())};if(q.outerHeight()>0){y()}else{s.closest("fieldset").one("show.fieldset",y)}}SelectFilter.refresh_icons(g)},refresh_icons:function(d){var g=b("#"+d+"_from");var f=b("#"+d+"_to");var e=g.find("option:selected").length>0;var c=f.find("option:selected").length>0;b("#"+d+"_add_link").toggleClass("active",e);b("#"+d+"_remove_link").toggleClass("active",c);b("#"+d+"_add_all_link").toggleClass("active",g.find("option").length>0);b("#"+d+"_remove_all_link").toggleClass("active",f.find("option").length>0)},filter_key_press:function(d,c){var e=document.getElementById(c+"_from");if((d.which&&d.which===13)||(d.keyCode&&d.keyCode===13)){e.selectedIndex=0;SelectBox.move(c+"_from",c+"_to");e.selectedIndex=0;d.preventDefault();return false}},filter_key_up:function(e,d){var f=document.getElementById(d+"_from");var c=f.selectedIndex;SelectBox.filter(d+"_from",document.getElementById(d+"_input").value);f.selectedIndex=c;return true},filter_key_down:function(d,c){var f=document.getElementById(c+"_from");if((d.which&&d.which===39)||(d.keyCode&&d.keyCode===39)){var e=f.selectedIndex;SelectBox.move(c+"_from",c+"_to");f.selectedIndex=(e===f.length)?f.length-1:e;return false}if((d.which&&d.which===40)||(d.keyCode&&d.keyCode===40)){f.selectedIndex=(f.length===f.selectedIndex+1)?0:f.selectedIndex+1}if((d.which&&d.which===38)||(d.keyCode&&d.keyCode===38)){f.selectedIndex=(f.selectedIndex===0)?f.length-1:f.selectedIndex-1}return true}}})(django.jQuery);